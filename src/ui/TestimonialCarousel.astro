---
const { testimonials = [] } = Astro.props;
const defaultAvatar = 'https://ui-avatars.com/api/?name=User&background=E0E7EF&color=374151&size=128&rounded=true';
---
<section id="testimonials" class="w-full py-20 px-4 bg-gradient-to-br from-white via-surface/10 to-white/80">
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <div class="max-w-4xl mx-auto">
    <div class="flex flex-col items-center mb-10">
      <span class="inline-block text-text-heading-dark mb-4 px-5 py-2 rounded-full bg-accent/90 text-on-primary font-semibold shadow text-sm">Success Stories</span>
      <h2 class="text-4xl md:text-5xl font-extrabold text-center mb-2 text-heading-light">
        What Our Clients <span class="text-accent">Are Saying</span>
      </h2>
      <p class="text-lg text-center text-body-light max-w-2xl mx-auto">
        Join thousands of satisfied customers who have transformed their businesses with our plumbing solutions.
      </p>
    </div>
    <div x-data="{ idx: 0, testimonials: JSON.parse($el.dataset.testimonials) }" data-testimonials={JSON.stringify(testimonials)} class="relative flex flex-col items-center">
      <div class="w-full flex justify-center">
        <div class="relative w-full max-w-2xl bg-white/80 backdrop-blur-lg rounded-3xl shadow-xl p-8 flex flex-col md:flex-row items-center gap-8 transition-all duration-500 border border-surface/10">
          <div class="flex flex-col items-center md:items-start">
            <div class="relative mb-4">
              <img :src="testimonials[idx].image || '${defaultAvatar}'" :alt="testimonials[idx].name" class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-lg" loading="lazy" />
            </div>
            <div class="font-bold text-heading-light text-lg" x-text="testimonials[idx].name"></div>
            <div class="text-accent text-sm font-semibold">
              <template x-if="testimonials[idx].link">
                <a :href="testimonials[idx].link" class="hover:underline" x-text="testimonials[idx].role + ', ' + testimonials[idx].company"></a>
              </template>
              <template x-if="!testimonials[idx].link">
                <span x-text="testimonials[idx].role + (testimonials[idx].company ? ', ' + testimonials[idx].company : '')"></span>
              </template>
            </div>
            <div class="text-body-light text-xs mt-1" x-text="testimonials[idx].industry"></div>
          </div>
          <div class="flex-1 flex flex-col justify-center">
            <div class="text-body-light text-xl mb-2 relative font-medium">
              <span class="absolute -left-6 top-0 text-accent text-3xl">â€œ</span>
              <span x-text="testimonials[idx].text"></span>
            </div>
          </div>
        </div>
      </div>
      <!-- Carousel Arrows -->
      <button
        @click="idx = (idx - 1 + testimonials.length) % testimonials.length"
        class="absolute left-0 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center bg-white/80 border border-surface/20 shadow-lg rounded-full transition-all duration-200 hover:bg-accent hover:text-on-primary hover:scale-110 focus:outline-none focus:ring-2 focus:ring-accent z-10 group"
        aria-label="Previous testimonial"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 group-hover:text-white transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
      </button>
      <button
        @click="idx = (idx + 1) % testimonials.length"
        class="absolute right-0 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center bg-white/80 border border-surface/20 shadow-lg rounded-full transition-all duration-200 hover:bg-accent hover:text-on-primary hover:scale-110 focus:outline-none focus:ring-2 focus:ring-accent z-10 group"
        aria-label="Next testimonial"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 group-hover:text-white transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>
</section> 