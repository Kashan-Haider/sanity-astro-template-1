---
interface Testimonial {
  name: string;
  role: string;
  company?: string;
  industry?: string;
  text: string;
  image?: string;
  link?: string;
}

const { testimonials = [] } = Astro.props;
const defaultAvatar = 'https://ui-avatars.com/api/?name=User&background=E0E7EF&color=374151&size=128&rounded=true';
---
<section id="testimonials" class="w-full py-20 px-4 bg-gradient-to-br from-light via-dark/10 to-light/80">
  <!-- Slick CSS -->
  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
  <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>
  
  <div class="w-full">
    <div class="flex flex-col items-center mb-10">
      <span class="inline-block mb-4 px-5 py-2 rounded-full bg-secondary/90 text-light font-semibold shadow text-sm">Success Stories</span>
      <h2 class="text-4xl md:text-5xl font-extrabold text-center mb-2 text-dark">
        What Our Clients <span class="text-secondary">Are Saying</span>
      </h2>
      <p class="text-lg text-center text-dark max-w-2xl mx-auto">
        Join thousands of satisfied customers who have transformed their businesses with our plumbing solutions.
      </p>
    </div>
    
    <!-- Slick Carousel -->
    <div class="px-5 md:px-10 lg:px-20 mx-auto">
      <div class="testimonial-carousel">
        {testimonials.map((testimonial: Testimonial) => (
          <div class="px-4 py-10 w-[300px]">
            <div class="bg-light/80 backdrop-blur-lg rounded-3xl shadow-xl p-8 flex flex-col items-center text-center transition-all duration-500 border border-dark/10 h-[450px] w-full">
              <div class="relative mb-4">
                <img src={testimonial.image || defaultAvatar} alt={testimonial.name} class="w-20 h-20 rounded-full object-cover border-4 border-light shadow-lg" loading="lazy" />
              </div>
              <div class="font-bold text-dark text-lg mb-2">{testimonial.name}</div>
              <div class="text-secondary text-sm font-semibold mb-1">
                {testimonial.link ? (
                  <a href={testimonial.link} class="hover:underline">{testimonial.role}, {testimonial.company}</a>
                ) : (
                  <span>{testimonial.role}{testimonial.company ? `, ${testimonial.company}` : ''}</span>
                )}
              </div>
              <div class="text-dark text-xs mb-4">{testimonial.industry}</div>
              <div class="text-dark text-lg relative font-medium">
                <span class="absolute -left-6 top-0 text-secondary text-3xl">"</span>
                <span>{testimonial.text}</span>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>

  <!-- jQuery and Slick JS -->
  <script src="//code.jquery.com/jquery-1.11.0.min.js" is:inline></script>
  <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js" is:inline></script>
  <script src="//cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js" is:inline></script>
  
  <script is:inline>
    // @ts-ignore
    $(document).ready(function(){
      // @ts-ignore
      $('.testimonial-carousel').slick({
        dots: true,
        infinite: true,
        speed: 500,
        slidesToShow: 4,
        slidesToScroll: 1,
        autoplay: true,
        autoplaySpeed: 5000,
        pauseOnHover: true,
        responsive: [
          {
            breakpoint: 1200,
            settings: {
              slidesToShow: 3,
              slidesToScroll: 1
            }
          },
          {
            breakpoint: 1024,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 1
            }
          },
          {
            breakpoint: 768,
            settings: {
              slidesToShow: 2,
              slidesToScroll: 1
            }
          },
          {
            breakpoint: 480,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1
            }
          }
        ]
      });
    });
  </script>

  <style>
    /* Custom Slick Styles */
    .slick-prev,
    .slick-next {
      width: 50px;
      height: 50px;
      background: #000;
      border: 2px solid rgba(191, 70, 90, 0.3);
      border-radius: 50%;
      color: #BF465A;
      z-index: 10;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .slick-prev:hover,
    .slick-next:hover {
      background: rgba(191, 70, 90, 0.95);
      color: #f8f9fa;
      border-color: rgba(191, 70, 90, 0.8);
      transform: scale(1.1);
    }
    
    .slick-prev {
      left: -25px;
    }
    
    .slick-next {
      right: -25px;
    }
    
    .slick-dots {
      bottom: -40px;
    }
    
    .slick-dots li button:before {
      color: #BF465A;
      opacity: 0.5;
      font-size: 12px;
    }
    
    .slick-dots li.slick-active button:before {
      opacity: 1;
      color: #BF465A;
    }
    
    /* Ensure arrows are visible on mobile */
    @media (max-width: 768px) {
      .slick-prev {
        left: -15px;
      }
      
      .slick-next {
        right: -15px;
      }
    }
  </style>
</section>
