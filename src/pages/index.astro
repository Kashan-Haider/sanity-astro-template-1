---
import Navbar from '../components/Navbar.astro';
import HeroSection from '../sections/HeroSection.astro';
import AboutSection from '../sections/AboutSection.astro';
import ServicesSection from '../sections/ServicesSection.astro';
import GalleryShowcase from '../ui/GalleryShowcase.astro';
import TestimonialCarousel from '../ui/TestimonialCarousel.astro';
import ServiceAreaSection from '../sections/ServiceAreaSection.astro';
import BusinessDetailsSection from '../sections/BusinessDetailsSection.astro';
import FooterSection from '../sections/FooterSection.astro';
import CompanyOverviewSection from '../sections/CompanyOverviewSection.astro';
import FAQSection from '../sections/FAQSection.astro';
import { sanityClient } from 'sanity:client';
import ServiceHighlights from '../sections/ServiceHighlights.astro';
import PreFooterSection from '../sections/PreFooterSection.astro';
import Layout from '../layouts/Layout.astro';

const templateId = import.meta.env.TEMPLATE_ID;
const documentId = import.meta.env.DOCUMENT_ID;

// Fetch complete template data from Sanity
const templateData = await sanityClient.fetch(`
  *[_type == "sanity-astro-template" && templateId == $templateId && documentId == $documentId][0] {
    businessName,
    seoSettings->{
      title,
      description,
      keywords,
      ogTitle,
      ogDescription,
      ogImage->{
        "url": image.asset->url,
        altText
      },
      ogUrl,
      favicon->{
        "url": image.asset->url,
        altText
      }
    },
    businessContact->{
      businessName,
      logo->{
        "url": image.asset->url,
        altText
      },
      phone,
      emergencyPhone,
      email,
      emergencyEmail,
      address,
      coordinates,
      businessHours
    },
    sections[] {
      _type,
      title,
      subtitle,
      description,
      isActive,
      // Hero section specific fields
      ctaButtons[] {
        label,
        href
      },
      // About section specific fields
      image->{
        "url": image.asset->url,
        altText
      },
      features,
      ctaButton {
        label,
        href
      },
      // Services section specific fields
      services[]->{
        title,
        description,
        image->{
          "url": image.asset->url,
          altText
        },
        features,
        ctaButton {
          label,
          href
        },
        category,
        isActive
      },
      // Gallery section specific fields
      items[]->{
        title,
        description,
        image->{
          "url": image.asset->url,
          altText
        },
        ctaButton {
          label,
          href
        },
        category,
        isActive
      },
      // Testimonials section specific fields
      testimonials[]->{
        name,
        role,
        company,
        industry,
        text,
        image->{
          "url": image.asset->url,
          altText
        }
      },
      // FAQ section specific fields
      faqs[]->{
        question,
        answer,
        category,
        isActive
      },
      // Service area section specific fields
      serviceAreas[]->{
        city,
        region,
        description,
        ctaButton {
          label,
          href
        }
      },
      // Business details section specific fields
      sections[] {
        title,
        description,
        ctaButton {
          label,
          href
        }
      },
      contactForm {
        title,
        isActive
      },
      map {
        isActive,
        latitude,
        longitude,
        locationName
      },
      // Company overview section specific fields
      sections[] {
        title,
        description,
        image->{
          "url": image.asset->url,
          altText
        }
      },
      // Service highlights section specific fields
      statistics[]->{
        value,
        label,
        icon,
        image->{
          "url": image.asset->url,
          altText
        },
        isActive
      },
      // Pre-footer section specific fields
      logo->{
        "url": image.asset->url,
        altText
      },
      socialLinks[]->{
        platform,
        url
      },
      // Footer section specific fields
      serviceAreas[]->{
        region,
        services
      },
      copyright
    },
    serviceAreas[]->{
      city,
      region,
      description,
      ctaButton {
        label,
        href
      }
    },
    socialLinks[]->{
      platform,
      url
    },
    theme
  }
`, { templateId, documentId });

// Extract sections by type for easier access
const heroSection = templateData?.sections?.find((section: any) => section._type === 'heroSection');
const aboutSection = templateData?.sections?.find((section: any) => section._type === 'aboutSection');
const servicesSection = templateData?.sections?.find((section: any) => section._type === 'servicesSection');
const gallerySection = templateData?.sections?.find((section: any) => section._type === 'gallerySection');
const testimonialsSection = templateData?.sections?.find((section: any) => section._type === 'testimonialsSection');
const faqSection = templateData?.sections?.find((section: any) => section._type === 'faqSection');
const serviceAreaSection = templateData?.sections?.find((section: any) => section._type === 'serviceAreaSection');
const businessDetailsSection = templateData?.sections?.find((section: any) => section._type === 'businessDetailsSection');
const companyOverviewSection = templateData?.sections?.find((section: any) => section._type === 'companyOverviewSection');
const serviceHighlightsSection = templateData?.sections?.find((section: any) => section._type === 'serviceHighlightsSection');
const preFooterSection = templateData?.sections?.find((section: any) => section._type === 'preFooterSection');
const footerSection = templateData?.sections?.find((section: any) => section._type === 'footerSection');


// SEO data
const seoData = templateData?.seoSettings;
const businessData = templateData?.businessContact;
console.log(companyOverviewSection)
---

<Layout 
  title={seoData?.title || 'AquaFlow Plumbing Services'}
  description={seoData?.description || 'Reliable plumbing services for homes and businesses. 24/7 certified experts for repairs, installations, and emergencies.'}
  theme={templateData?.theme}
  seoData={seoData}
>
  <Navbar />
  
      {heroSection && (
      <HeroSection 
        title={heroSection.title}
        subtitle={heroSection.subtitle}
        description={heroSection.description}
        ctaButtons={heroSection.ctaButtons}
      />
    )}
  
  {serviceHighlightsSection && (
    <ServiceHighlights 
      title={serviceHighlightsSection.title}
      statistics={serviceHighlightsSection.statistics}
    />
  )}

  {companyOverviewSection && (
    <CompanyOverviewSection 
      companyName={templateData.businessName}
      sections={companyOverviewSection.sections}
    />
  )}
    {aboutSection && (
      <AboutSection 
        title={aboutSection.title}
        description={aboutSection.description}
        features={aboutSection.features}
        ctaButton={aboutSection.ctaButton}
      />
    )}

{servicesSection && (
  <ServicesSection 
    title={servicesSection.title}
    description={servicesSection.description}
    ctaButton={servicesSection.ctaButton}
  />
)}

{gallerySection && (
  <GalleryShowcase />
)}
  {businessDetailsSection && (
    <BusinessDetailsSection 
      title={businessDetailsSection.title}
      sections={businessDetailsSection.sections}
      contactForm={businessDetailsSection.contactForm}
      map={businessDetailsSection.map}
    />
  )}



  <!-- 
  
  
  
  
  {testimonialsSection && (
    <TestimonialCarousel 
      title={testimonialsSection.title}
      description={testimonialsSection.description}
      testimonials={testimonialsSection.testimonials}
    />
  )}
  
  {faqSection && (
    <FAQSection 
      title={faqSection.title}
      description={faqSection.description}
      faqs={faqSection.faqs}
    />
  )}
  
  {serviceAreaSection && (
    <ServiceAreaSection 
      title={serviceAreaSection.title}
      description={serviceAreaSection.description}
      serviceAreas={serviceAreaSection.serviceAreas}
      ctaButton={serviceAreaSection.ctaButton}
    />
  )}
  
  {preFooterSection && (
    <PreFooterSection 
      logo={preFooterSection.logo}
      description={preFooterSection.description}
      socialLinks={preFooterSection.socialLinks}
    />
  )}
  
  {footerSection && (
    <FooterSection 
      serviceAreas={footerSection.serviceAreas}
      copyright={footerSection.copyright}
    />
  )} -->
</Layout>
