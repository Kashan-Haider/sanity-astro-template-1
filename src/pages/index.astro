---
import Navbar from '../components/Navbar.astro';
import HeroSection from '../sections/HeroSection.astro';
import AboutSection from '../sections/AboutSection.astro';
import ServicesSection from '../sections/ServicesSection.astro';
import GalleryShowcase from '../ui/GalleryShowcase.astro';
import TestimonialCarousel from '../ui/TestimonialCarousel.astro';
import ServiceAreaSection from '../sections/ServiceAreaSection.astro';
import BusinessDetailsSection from '../sections/BusinessDetailsSection.astro';
import FooterSection from '../sections/FooterSection.astro';
import CompanyOverviewSection from '../sections/CompanyOverviewSection.astro';
import FAQSection from '../sections/FAQSection.astro';
import { sanityClient } from 'sanity:client';
import ServiceHighlights from '../sections/ServiceHighlights.astro';
import PreFooterSection from '../sections/PreFooterSection.astro';
import Layout from '../layouts/Layout.astro';

const templateId = import.meta.env.TEMPLATE_ID;
const documentId = import.meta.env.DOCUMENT_ID;

// Fetch complete template data from Sanity
const templateData = await sanityClient.fetch(`
  *[_type == "sanity-astro-template" && templateId == $templateId && documentId == $documentId][0] {
    businessName,
    seoSettings->{
      title,
      description,
      keywords,
      ogTitle,
      ogDescription,
      ogImage,
      ogUrl,
      favicon
    },
    businessContact->{
      businessName,
      phone,
      emergencyPhone,
      email,
      emergencyEmail,
      address,
      coordinates,
      businessHours
    },
    sections[] {
      ...select(
        _type == "heroSection" => {
          _type,
          title,
          subtitle,
          description,
          ctaButtons
        },
        _type == "aboutSection" => {
          _type,
          title,
          description,
          features,
          ctaButton
        },
        _type == "servicesSection" => {
          _type,
          title,
          description,
          services[]-> {
            title,
            description,
            features,
            ctaButton
          },
          ctaButton
        },
        _type == "gallerySection" => {
          _type,
          title,
          description
        },
        _type == "testimonialsSection" => {
          _type,
          title,
          description,
          testimonials[]-> {
            name,
            role,
            company,
            industry,
            text,
            image
          }
        },
        _type == "faqSection" => {
          _type,
          title,
          description,
          faqs[]-> {
            question,
            answer,
            category
          }
        },
        _type == "serviceAreaSection" => {
          _type,
          title,
          description,
          serviceAreas[]-> {
            city,
            region,
            description,
            ctaButton
          },
          ctaButton
        },
        _type == "businessDetailsSection" => {
          _type,
          title,
          sections[]{
            title,
            description,
            ctaButton
          },
          contactForm,
          map
        },
        _type == "companyOverviewSection" => {
          _type,
          title,
          sections[]{
            title,
            description
          },
          ctaButton
        },
        _type == "serviceHighlightsSection" => {
          _type,
          title,
          statistics[]-> {
            value,
            label
          }
        },
        _type == "preFooterSection" => {
          _type,
          description,
          socialLinks[]-> {
            platform,
            url
          }
        },
        _type == "footerSection" => {
          _type,
          serviceAreas[]-> {
            region,
            services
          },
          copyright
        }
      )
    },
    serviceAreas[]-> {
      city,
      region,
      description,
      ctaButton
    },
    socialLinks[]-> {
      platform,
      url
    },
    theme
  }
`, { templateId, documentId });


// Extract sections by type for easier access
const heroSection = templateData?.sections?.find((section: any) => section._type === 'heroSection');
const aboutSection = templateData?.sections?.find((section: any) => section._type === 'aboutSection');
const servicesSection = templateData?.sections?.find((section: any) => section._type === 'servicesSection');
const gallerySection = templateData?.sections?.find((section: any) => section._type === 'gallerySection');
const testimonialsSection = templateData?.sections?.find((section: any) => section._type === 'testimonialsSection');
const faqSection = templateData?.sections?.find((section: any) => section._type === 'faqSection');
const serviceAreaSection = templateData?.sections?.find((section: any) => section._type === 'serviceAreaSection');
const businessDetailsSection = templateData?.sections?.find((section: any) => section._type === 'businessDetailsSection');
const companyOverviewSection = templateData?.sections?.find((section: any) => section._type === 'companyOverviewSection');
const serviceHighlightsSection = templateData?.sections?.find((section: any) => section._type === 'serviceHighlightsSection');
const preFooterSection = templateData?.sections?.find((section: any) => section._type === 'preFooterSection');
const footerSection = templateData?.sections?.find((section: any) => section._type === 'footerSection');


// SEO data
const seoData = templateData?.seoSettings;
const businessData = templateData?.businessContact;
console.log(businessDetailsSection)
---

<Layout 
  title={seoData?.title || 'AquaFlow Plumbing Services'}
  description={seoData?.description || 'Reliable plumbing services for homes and businesses. 24/7 certified experts for repairs, installations, and emergencies.'}
  theme={templateData?.theme}
  seoData={seoData}
>
  <Navbar />
  
      {heroSection && (
      <HeroSection 
        title={heroSection.title}
        subtitle={heroSection.subtitle}
        description={heroSection.description}
        ctaButtons={heroSection.ctaButtons}
      />
    )}
  
  {serviceHighlightsSection && (
    <ServiceHighlights 
      title={serviceHighlightsSection.title}
      statistics={serviceHighlightsSection.statistics}
    />
  )}

  {companyOverviewSection && (
    <CompanyOverviewSection 
      companyName={templateData.businessName}
      sections={companyOverviewSection.sections}
    />
  )}
    {aboutSection && (
      <AboutSection 
        title={aboutSection.title}
        description={aboutSection.description}
        features={aboutSection.features}
        ctaButton={aboutSection.ctaButton}
      />
    )}

{servicesSection && (
  <ServicesSection 
    title={servicesSection.title}
    description={servicesSection.description}
    ctaButton={servicesSection.ctaButton}
  />
)}

{gallerySection && (
  <GalleryShowcase />
)}
  {businessDetailsSection && (
    <BusinessDetailsSection 
      title={businessDetailsSection.title}
      sections={businessDetailsSection.sections}
      contactForm={businessDetailsSection.contactForm}
      map={businessDetailsSection.map}
    />
  )}



  <!-- 
  
  
  
  
  {testimonialsSection && (
    <TestimonialCarousel 
      title={testimonialsSection.title}
      description={testimonialsSection.description}
      testimonials={testimonialsSection.testimonials}
    />
  )}
  
  {faqSection && (
    <FAQSection 
      title={faqSection.title}
      description={faqSection.description}
      faqs={faqSection.faqs}
    />
  )}
  
  {serviceAreaSection && (
    <ServiceAreaSection 
      title={serviceAreaSection.title}
      description={serviceAreaSection.description}
      serviceAreas={serviceAreaSection.serviceAreas}
      ctaButton={serviceAreaSection.ctaButton}
    />
  )}
  
  {preFooterSection && (
    <PreFooterSection 
      logo={preFooterSection.logo}
      description={preFooterSection.description}
      socialLinks={preFooterSection.socialLinks}
    />
  )}
  
  {footerSection && (
    <FooterSection 
      serviceAreas={footerSection.serviceAreas}
      copyright={footerSection.copyright}
    />
  )} -->
</Layout>
